\chapter{脑电图和脑磁图动态因果建模}
\label{ch:16}


\section{简介}

动态因果建模（Dynamic Causal  Modelling，DCM）最初是为 fMRI 数据开发的。
它通过一个由几个源组成的网络模型来解释测量数据，这些源之间动态交互。
该网络模型使用贝叶斯方法进行反演，从而可以对源之间的连接或任务调节连接进行推断。

对于 M/EEG 数据，DCM 是一种强大的技术，可用于推断那些不能通过 M/EEG 直接观察到的参数。
与其问“左侧上颞回（STG）源的强度在条件 A 和 B 之间是如何变化的？”，不如问“这个左侧 STG 源到左初级听觉皮层的反向连接在条件 A 和 B 之间是如何变化的？”。
换句话说，不仅限于关于源强度的问题，还可以测试源之间在网络中的动态发生了什么。

相比 fMRI 数据，M/EEG 数据在时间上具有更高的分辨率，因此推断的参数更具神经生物学上的可行性。
这些参数更直接地与潜在神经动态的原因相关。

2006 年，关于 M/EEG 的关键 DCM 方法论文发表，第一批关于失配负波（mismatch negativity，MMN）的 DCM 研究在 2007/2008 年出现。
本质上，DCM 对于 M/EEG 是一种源重建技术，在空间域中我们使用与其他方法完全相同的 leadfields。
然而，使 DCM 独特的是它结合了生物学上知情的时间前向模型，描述了例如源之间的连接。
这一关键成分不仅通过隐式约束空间参数使源重建更加稳健，还可以推断关于连接的信息。

我们的方法组正在继续改进和扩展 DCM。
在接下来的部分中，我们将描述用于诱发反应的 DCM（包括 MEG 和 EEG）、用于诱发反应（即基于时间-频率域中的功率数据）的DCM以及用于局部场电位（测量为稳态反应）的 DCM。
所有这三种 DCM 共享相同的界面，因为需要指定的许多参数对于这三种方法是相同的。
因此，我们将首先描述用于诱发反应的 DCM，然后指出与另外两种 DCM 的不同之处。

本手册仅提供了DCM用于M/EEG的实用程序指南。
如果您想了解更多关于科学背景、使用的算法或如何在应用中典型使用DCM的信息，我们推荐以下阅读材料。
两个关键方法贡献可以在\cite{u29}和\cite{u76}中找到。
使用该模型来测试神经动态有趣假设的另外两个贡献在\cite{u77}和\cite{u33}中有描述。
在撰写本文时，还有三篇应用论文发表，展示了可以使用DCM测试的假设类型\cite{u56,u55,u54}。
另一个很好的背景信息来源是最近的SPM书籍\cite{u36}，其中第6和第7部分不仅涵盖了DCM用于M/EEG，还涵盖了我们小组的相关研究。
用于诱发反应和稳态反应的DCM在\cite{u23,u22}和\cite{u91,u87,u88}中有详细介绍。
请注意，我们在网页http://www.fil.ion.ucl.ac.uk/spm/data/eeg\_mmn/ 上提供了一个DCM示例文件。
下载DCMexample.mat后，您可以使用DCM GUI加载该文件（见下文），并在阅读以下描述后查看各种选项或更改一些选项。


\section{概述}

总之，DCM的目标是解释测量数据（如诱发反应）作为由几个区域组成的交互网络的输出，其中一些区域接收输入（即刺激）。
在不同条件下测量的诱发反应之间的差异被建模为选定DCM参数（如皮质间连接）的调制\cite{u29}。
这种对诱发反应的解释使得关于连接性的假设可以直接进行测试。
例如，可以问，两个诱发反应之间的差异是否可以通过早期区域的自上而下调制来解释\cite{u56}。
重要的是，由于模型反演是使用贝叶斯方法实现的，因此还可以计算贝叶斯模型证据。
这些证据可以用来比较替代的、同样合理的模型，并决定哪个是最好的\cite{u78}。

用于诱发反应的DCM考虑了空间前向模型。
这使得DCM成为全数据集（跨通道和刺激前后时间）的时空模型。
或者，也可以将DCM描述为一种时空源重建算法，利用神经质量动态和长程有效连接提供的附加时间约束来实现。
这是通过参数化导向场来实现的，即源活动到传感器的空间投影。
在当前版本中，这可以使用两种不同的方法完成。
第一种方法假设每个源的导向场由单个等效电流偶极子（ECD）建模\cite{u76}。
第二种方法假定每个源可以表示为灰质片上的“补丁”偶极子\cite{u28}。
这种空间模型由每个源的时间动态模型补充。
重要的是，这些动态不仅描述了内部源动态如何随时间演变，还描述了源如何对来自皮质下区域（刺激）或其他皮质源的外部输入做出反应。

GUI允许输入指定给定数据集的时空模型所需的所有信息。
如果要拟合多个模型，建议使用批处理脚本。
可以在发行版的man/example\_scripts/文件夹中找到一个可以适应自己数据的脚本示例（DCM\_ERP\_example）。
你可以在SPM网页上提供的示例数据上运行这个脚本（http://www.fil.ion.ucl.ac.uk/spm/data/eeg\_mmn/）。
但是，你首先需要预处理这些数据以生成诱发反应，可以通过进行预处理教程（第\ref{ch:40}章）或运行example\_scripts文件夹中的history\_subject1.m脚本来实现。


\section{调用DCM用于ERP/ERF}

调用spm\_eeg后，会看到SPM的图形用户界面，即左上角的窗口。
调用DCM-GUI的按钮位于顶部第二部分的右侧。
按下按钮后，GUI会弹出。
GUI分为五个部分，从上到下依次排列。
第一部分是关于加载和保存现有DCM以及选择模型类型。
第二部分是选择数据，第三部分是空间前向模型的指定，第四部分是连接性的指定，最后一行按钮用于估计参数和查看结果。

你必须首先选择数据并按固定顺序指定模型（数据选择 $>$ 空间模型 $>$ 连接模型）。
这种顺序是必要的，因为三部分之间存在依赖关系，如果输入可以按任何顺序输入，这些依赖关系将很难解决。
你可以随时在各部分之间来回切换。
此外，在每个部分内，你可以按任意顺序指定信息。


\section{加载、保存和选择模型类型}

在GUI的顶部，你可以加载现有的DCM或保存当前正在处理的DCM。
通常，你可以在模型指定的任何时候保存和加载。
此外，你还可以在不同的DCM分析之间切换（左侧菜单）。
默认的是“ERP”，即本文描述的用于诱发反应的DCM。
目前，其他类型包括交叉谱密度（CSD）、诱发反应（IND）和相位耦合（PHA），这些将在本章后面描述。
右侧菜单允许你选择神经模型。
“ERP”是描述在我们大多数旧论文中的标准模型，例如\cite{u29}。
'SEP'使用了这种模型的变体，然而，动力学趋于更快\cite{u84}。
'NMM'是基于一阶近似的非线性神经质量模型，而'MFM'也是非线性的，基于二阶近似。
'NMDA'是'NMM'模型的一个变体，包含了NMDA受体的模型。
'CMC'和'CMM'是典型的微电路模型\cite{u16}，在最近的文章中用于将神经生理现象的模型与基于预测编码理念的皮层处理典型模型联系起来。


\section{数据和设计}

在这一部分，你需要选择数据并在试验间建模。
数据可以是事件相关电位或场，这些数据必须是SPM格式。
在右侧，你可以输入SPM文件中诱发反应的试验索引。
例如，如果你想建模SPM文件中包含的第二和第三个诱发反应，请指定索引2和3。
索引对应于condlist方法指定的顺序（参见第\ref{ch:12}章）。
如果由于某种原因，这两个诱发反应在不同的文件中，你需要先合并这些文件。
你可以使用SPM预处理功能合并（spm\_eeg\_merge），见第\ref{ch:12}章。
你还可以选择如何建模实验效应（即条件之间的差异）。
例如，如果试验1是标准反应，试验2是在一个oddball范式中的偏差反应，你可以使用标准反应作为基线，并建模连接中为适应偏差而必要的差异。
为此，在试验索引下的文本框中输入0 1。
或者，如果你输入-1 1，那么基线将是两个条件的平均值，并且相同的因子将从基线连接值中减去以建模标准反应，并添加以建模偏差反应。
后一个选项可能不适用于oddball范式，但可能适用于没有明确“基线条件”的其他范式。
当你想建模三个或更多的诱发反应时，你可以分别建模第二和第三诱发反应相对于第一个诱发反应的连接强度调制作为两个独立的实验效应。
然而，你也可以选择通过施加线性关系来耦合第一个诱发反应的连接强度和两个增益，指定单一效应（例如-1 0 1）。
这在添加约束条件时特别有用，例如连接（或其他DCM参数）在试验间的变化。
一个引人注目的例子见\cite{u54}。
对于每个实验效应，你将能够选择模型中受其影响的连接（见下文）。

按下“数据文件”按钮加载M/EEG数据集。
在“时间窗口（毫秒）”下，你需要输入要建模的刺激时间，例如1到200毫秒。

你可以选择是否在传感器级别建模数据的平均值或漂移。
选择1表示“去趋势”仅建模平均值。
否则，选择要用来建模低频漂移的离散余弦变换项的数量（$>$1）。
在DCM中，我们使用数据的子空间投影来减少数据量。
空间投影的类型见\cite{u33}。
你可以选择要保留的模式数量，默认是8。

你还可以选择用hanning窗口沿刺激时间窗口化数据（单选按钮）。
这种窗口化将减少时间序列开始和结束对数据的影响。

如果你对数据选择、投影和去趋势项满意，可以点击“$>$”（前进）按钮，进入下一个电磁模型阶段。
从这一部分，你可以按红色的“$<$”按钮返回到数据和设计部分。


\section{电磁模型}

在当前版本的DCM中，你有三种选择来空间建模你的诱发反应。
你可以为每个源使用单一的等效电流偶极子（ECD），或者使用皮层表面的一个补丁（IMG），或者完全不使用空间模型（局部场电位（LFP））。
在这三种情况下，你都需要输入源的名称（每行一个名称）。
对于ECD和IMG，你需要指定先验源位置（以MNI坐标系的毫米为单位）。
需要注意的是，默认情况下，DCM在偶极子方向上使用非信息先验，但在位置上使用紧密先验。
这是因为位置上的紧密先验确保了后验位置不会偏离其先验位置太多，这意味着每个偶极子都会留在其指定区域并保持其意义。
每个偶极子的先验位置可以通过使用现有的解剖学知识或依赖于类似研究的源重建来找到。
还需要注意的是，先验位置不需要非常精确，因为M/EEG的空间分辨率在几毫米的尺度上。
你也可以从文件中加载先验位置（“load”）。
当你按下“dipoles”时，可以可视化所有源的位置。

起始参数决定了在0毫秒的刺激时间时，假定刺激激活的皮层区域。
通常在DCM中，我们不建模较小的早期反应，而是从第一个大偏转开始建模。
由于刺激脉冲通过输入节点传播会导致延迟，我们发现默认的60毫秒起始时间对于许多在100毫秒左右出现第一个大偏转的诱发反应是一个不错的值。
然而，这个值是一个先验，即反演程序可以调整它。
先验均值应该根据特定的反应来选择。
这是因为直到第一个大偏转的时间取决于你所使用的范式或模态，例如听觉或视觉。
你还可能发现改变起始先验会对你的数据拟合产生影响。
这是因为起始时间对数据有很强的非线性效应（延迟），这可能导致在不同的先验值下收敛时找到的最大值不同。
还可以在这个框中输入多个数字（相同或不同），然后会有多个输入，它们的时间可以分别优化。
这些输入可以连接到不同的模型源。
这对于建模带有组合听觉和视觉刺激的范式非常有用。
“持续时间（标准差）”框使得可以单独调整每个输入的输入脉冲宽度。
这可以更接近地建模实际的输入结构（例如长音调或延长的视觉输入呈现）。
通过结合不同持续时间的多个输入，可以近似一个更复杂的输入波形（例如语音）。

当你想继续到下一个模型规范阶段时，点击“$>$”（前进）按钮，继续到神经模型。


\section{神经模型}

你需要通过按按钮指定五个（或更多）矩阵。
前三个是第一个诱发反应的连接强度参数。
有三种类型的连接：前向、后向和横向。
在每个矩阵中，你指定从源区域到目标区域的连接。
例如，在内在前向连接矩阵中打开元素（2, 1）意味着你指定了从区域1到区域2的前向连接。
有些人觉得每个元素的含义有点反直觉，因为列索引对应源区域，而行索引对应目标区域。
这种约定是由于在GUI中的按钮矩阵与DCM方程中的连接矩阵之间的直接对应关系，并且对于熟悉矩阵乘法的人来说应该是清楚的。

你之前指定的一个或多个输入可以到任何区域和多个区域。
你可以通过在C输入向量中选择区域索引来选择接收区域。

B矩阵包含所有由A矩阵中设置的连接强度的增益调制。
这些调制建模了第一个和其他模型诱发反应之间的差异。
例如，对于两个诱发反应，DCM仅使用A矩阵来解释第一个反应。
第二个反应通过调制B矩阵中的权重来建模这些连接。


\section{估计}

当你完成模型规范后，可以点击左下角的估计按钮。
如果这是第一次估计，并且你没有尝试过使用该文件进行其他源重建，DCM将构建一个空间前向模型。
你可以使用模板头部模型来快速获得结果。
DCM现在将估计模型参数。
你可以通过观察输出窗口中的模型拟合来跟踪估计过程。
在Matlab命令窗口中，你会看到每次迭代的打印输出，包括期望最大化迭代次数、自由能F以及每个迭代步骤后的预测和实际F变化。
在收敛时，DCM会将结果保存到一个DCM文件，默认名称为DCM\_ERP.mat。
如果你要估计多个模型，可以通过在GUI顶部按“保存”并写入不同的名称来保存为不同的名称。


\section{结果}

估计完成后，你可以通过底部中间的下拉菜单选择结果评估。

选择 ERPs (mode) 时，可以为每种模式绘制两个诱发反应的数据和模型拟合。

选择 ERPs (sources) 时，会绘制每个区域的动态。
锥体细胞的活动（重建的源活动）以实线表示，两种中间神经元群体的活动以虚线表示。

选择 coupling (A) 会显示 A 矩阵中连接的后验分布摘要。
在上方，显示所有内在连接的后验均值。
与前述相同，元素(i, j) 对应于从区域j到i的连接。
在下方，你可以找到每个连接的后验均值与先验均值不同的概率，考虑到后验方差。

选择 coupling (B) 可以查看内在连接增益调制的后验均值及其与先验均值不同的概率。
如果你指定了多个实验效应，你将被询问想查看哪一个。

选择 coupling (C) 可以查看输入接收区域强度的后验分布摘要。
左侧显示每个区域的后验均值，右侧显示相应的概率。

选择 Input 显示估计的输入函数。
根据 \cite{u29} 描述，这是一种伽马函数，外加低频项。

选择 Response，可以绘制选定的数据，即通过空间模式选择的数据，但反投影到传感器空间。

选择 Response (image)，你将看到与 Results 下相同的内容，但以灰度图像显示。

最后，选择 Dipoles，DCM 使用其 3 个方向参数和 3 个位置参数的后验均值在 MRI 模板上显示每个偶极子的叠加。
这只有在你在电磁模型下选择了 ECD 模型时才有意义。

在估计之前，当你按下“初始化”按钮时，你可以将参数值分配为自由能梯度上升方案的初始起点。
这些值取自另一个已经估计的 DCM，你需要选择它。

按钮 BMS 允许你对多个模型进行贝叶斯模型比较。
它将打开用于模型选择的 SPM 批处理工具。
指定一个目录以写入输出文件。
对于“推理方法”，你可以选择“固定效应”或“随机效应”（参见 \cite{u104} 了解更多解释）。
如果不确定，请选择“固定效应”。
然后点击“数据”，在下面的框中点击“新建：主题”。
点击“主题”，在下面的框中点击“新建：会话”。
点击模型，在弹出的选择窗口中选择所有模型的 DCM mat 文件（记住选择文件的顺序，因为这对于解释结果是必要的）。
然后按下绿色的“运行”按钮运行模型比较。
顶部将显示所有模型的对数模型证据的条形图。
底部将显示每个模型生成数据的概率。
按照惯例，如果某个模型的对数模型证据超过其他所有模型的对数模型证据至少3，可以说该模型在所有选定的模型中是最好的，具有强有力的证据。


\section{交叉谱密度}


\subsection{模型规格说明}

交叉谱密度（CSD）的DCM（Dynamic Causal Modelling）可以应用于M/EEG或颅内数据。

在DCM for ERP窗口的顶部面板，可以切换可用的分析方法。
在左上角的下拉菜单中，选择“CSD”。
右上角面板的第二个下拉菜单允许你指定分析是否应使用对状态线性的模型。
你可以选择“ERP”或“CMC”来实现这一点。
或者，你可以通过选择“NMM”、“MFM”或“NMDA”来使用基于导电性的模型，该模型对状态是非线性的（有关差异的描述，请参见\cite{u84}）。

稳态（频率）响应是自动从时域记录生成的。
频率响应的时间持续时间在第二个面板中的时间窗口输入。
去趋势选项允许你从通道数据中删除1阶、2阶、3阶或4阶多项式漂移。
在子采样选项中，你可以选择在构建频率响应之前对数据进行降采样。
模式数指定了引导场中存在于通道数据中的成分数量。
试验间效应和设计矩阵的输入与ERPs的情况相同，如上所述。


\subsection{引导场}

交叉谱密度是对这些神经源观察输出之间依赖关系的描述。
为了实现这种频域描述，我们必须首先指定可能的源及其位置。
如果使用LFP（局部场电位）数据，那么只需要提供源的名称。
这些信息可以通过选择“LFP”在第三个面板中添加。
或者，可以为ECD（等效电流偶极子）或IMG（成像）解决方案指定x、y、z坐标。


\subsection{连接}

然后，在底部面板中，可以指定源之间的连接，以及这些连接是否会在不同试验类型之间发生变化。

在第一行中，可以在区域之间指定三种连接类型。
对于NMM和MFM选项，这些是兴奋性、抑制性或混合兴奋性和抑制性连接。
在使用ERP选项时，用户将指定连接是“前向”、“后向”还是“横向”。
要指定连接，请开启特定连接矩阵条目。
例如，要指定从源3到源1的抑制性连接，请在位置（3,1）开启“抑制”条目。

在这一行中还指定了输入。
这些是外部实验输入进入网络的位置。

下一行的矩阵允许用户选择上面指定的哪些连接可以在试验类型之间变化。
例如，在两个源的网络中有两个混合连接（1,2）和（2,1），你可能希望只允许其中一个根据实验上下文变化。
在这种情况下，如果你希望从源2到源1的混合连接根据试验类型变化，那么在最后一个连接矩阵中选择条目（2,1）。


\subsection{交叉频谱密度}

最后一个选择是关于你希望建模的频率。
这些频率可以是宽频带的一部分，例如默认的4-48 Hz，或者你可以输入一个窄频带，例如8到12 Hz，这将以1Hz的增量建模alpha频带。
一旦点击“反转DCM”选项，交叉频谱密度将自动计算（使用频谱工具箱）。
用于反转的数据包括通道或通道模式之间的自频谱和交叉频谱。
这是使用多变量自回归模型计算的，该模型可以准确地测量时间域数据中的周期性。
总体而言，频谱被表示为一个上三角形的s x s矩阵，主对角线上是自频谱，非对角线项中是交叉频谱。


\subsection{输出与结果}

结果菜单提供了多种数据估计。
通过检查“频谱数据”，你可以看到以上述矩阵格式表示的观察频谱。
选择“交叉频谱密度”可以同时查看观察到的和预测的响应。
要检查连接性估计，可以选择“耦合（A）”结果选项；对于调制参数，选择“耦合（B）”选项。
你还可以通过选择“耦合（C）”选项检查每个源的输入强度，就像在ERP的DCM中一样。
“特定试验效果”选项显示了连接参数估计（来自B）相对于基线连接（来自A）的逐试验变化。
要检查这些源的频谱输入，选择“输入”选项；这应该看起来像是白噪声和粉红噪声的混合。
最后，“偶极子”选项允许你可视化模型中所有偶极子的后验位置和方向。


\section{诱发反应}

诱发反应的DCM旨在模拟分别与线性和非线性机制相关的频率内和频率间耦合。
进行此操作的过程类似于ERP/ERF的DCM。
在接下来的内容中，我们将指出在GUI中如何指定模型的不同之处。
在使用该技术之前，建议阅读有关诱发反应DCM背后的原理\cite{u23}。


\subsection{数据}

要建模的数据必须是单次试验的、划分成小段的数据。
我们将建模整个频谱，包括诱发（与刺激相位锁定）和诱发（与刺激非相位锁定）成分。


\subsection{电磁模型}

目前，诱发响应的 DCM 仅使用 ECD（等效电流偶极子）方法来捕捉数据特征。
需要注意的是，与诱发响应的 DCM 不同，空间模型的参数不会被优化。
这意味着，诱发响应的 DCM 将使用您提供的空间位置将数据投射到源空间。


\subsection{神经元模型}

这是指定连接架构的地方。
需要注意的是，在诱发响应的 DCM 中，A 矩阵编码了源之间的线性和非线性耦合强度。


\subsection{小波变换}

在连接按钮下可以调用此功能，使数据通过 Morlet 小波变换转移到时频域，作为特征提取的一部分。
有两个参数：频率窗口定义了所需的频率范围，小波数量则指定了时间-频率分辨率。
我们建议使用大于 5 的值以获得稳定的估计。


\subsection{结果}

频率模式:
这将显示频率模式，使用源空间中光谱动态的奇异值分解（在时间和源上的）识别出频率模式。

时频:
这将显示所有预先指定源的观察到的时频功率数据（上面板）和拟合数据（下面板）。

耦合（A-Hz）:
这将显示表示从源频率到目标频率耦合强度的耦合矩阵。


\section{相位耦合反应}

相位耦合反应的DCM（动态因果模型）基于神经相互作用的弱耦合振荡器模型。


\subsection{数据}

要建模的数据必须是多次试验的分段数据。
需要多次试验以便充分探索相位差的全状态空间。
通过多次试验，每次试验可能包含不同的初始相对相位偏移，从而实现这一目标。
不同试验类型的信息输入方式与DCM（动态因果模型）用于ERP（事件相关电位）时相同，即使用设计矩阵。
相位耦合的DCM旨在建模向同步状态的动态过渡。
由于这些过渡是短暂的，建议使用短时间窗口的数据进行建模，并且振荡频率越高，建议的时间窗口越短。
如果使用长时间窗口或大量试验，可能会导致DCM相位耦合运行时出现内存问题。


\subsection{电磁模型}

目前，相位耦合响应的DCM可以处理ECD（等效电流偶极子）或LFP（局部场电位）数据。
需要注意的是，与用于诱发响应的DCM不同，相位耦合响应的DCM不会优化空间模型的参数。
这意味着，相位耦合响应的DCM将根据您提供的空间位置将数据投影到源空间中。


\subsection{神经元模型}

在这一部分，您需要为弱耦合振荡器模型指定连接结构。
如果使用GUI，阶段交互函数由aij sin(φi - φj)给出，其中aij是A矩阵中出现的连接权重，φi和φj是区域i和j的相位。
相位耦合响应的DCM也可以通过MATLAB脚本运行。
这提供了更大的灵活性，因为阶段交互函数可以使用任意阶傅里叶级数进行近似。
请查看example\_scripts以了解更多信息。


\subsection{希尔伯特变换}

按下这个按钮会执行两个操作。
首先，源数据将被带通滤波到指定的范围内。
其次，将应用希尔伯特变换，从中获得相位变量的时间序列。


\subsection{结果}

Sin(数据) - 区域 i:
此选项绘制数据的正弦值（即相位变量的正弦值）以及相应的模型拟合结果，针对第 i 个区域。

耦合 (A), (B):
此选项显示固有耦合矩阵和调制耦合矩阵。
A 矩阵中的 i, j 项表示第 i 区域调整其相位以与第 j 区域对齐的速度。
B 矩阵中的相应项显示这些值如何因实验操纵而改变。